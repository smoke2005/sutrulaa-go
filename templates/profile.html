<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile</title>
  <style>
    body { background: #e0f7fa; font-family: 'Poppins', sans-serif; margin: 0; }
    .header { background: #48c6ef; color: #fff; padding: 32px 0 24px 0; text-align: center; font-size: 2.5rem; font-weight: bold; letter-spacing: 2px; }
    .main-flex { display: flex; justify-content: center; align-items: flex-start; gap: 36px; max-width: 1100px; margin: 40px auto; }
    .profile-container { flex: 2; background: #fff; border-radius: 24px; box-shadow: 0 4px 24px #b2ebf2; padding: 32px 24px; min-width: 340px; }
    .profile-pic-wrap { display: flex; flex-direction: column; align-items: center; margin-bottom: 24px; }
    .profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #48c6ef; background: #b2ebf2; }
    .edit-btn { margin-top: -36px; margin-left: 80px; background: #fff; border: 2px solid #48c6ef; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; color: #48c6ef; }
    .profile-info { text-align: center; }
    .profile-name { font-size: 1.5rem; font-weight: bold; margin-bottom: 4px; }
    .profile-email { font-size: 1rem; color: #888; margin-bottom: 16px; }
    .stats { display: flex; justify-content: space-between; margin: 24px 0; }
    .stat { flex: 1; text-align: center; }
    .stat-label { font-size: 1rem; color: #48c6ef; }
    .stat-value { font-size: 1.3rem; font-weight: bold; }
    .desc-section { margin: 24px 0; }
    .desc-label { font-weight: bold; color: #48c6ef; }
    .desc-text { margin-top: 8px; }
    .desc-edit { color: #48c6ef; cursor: pointer; margin-left: 8px; }
    .posts-section { margin-top: 32px; }
    .posts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .post-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; }
    /* Right column (badges) */
    .badge-container { flex: 1; background: #fff; border-radius: 20px; box-shadow: 0 4px 24px #b2ebf2; padding: 28px 18px; min-width: 220px; }
    .badge-title { font-size: 1.2rem; color: #48c6ef; font-weight: bold; margin-bottom: 18px; text-align: center; }
    .upload-badge-form { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 18px; }
    .custom-file-input {
      display: none;
    }
    .custom-file-label {
      display: inline-block;
      background: #b2ebf2;
      color: #48c6ef;
      border: 2px dashed #48c6ef;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, color 0.2s;
    }
    .custom-file-label:hover {
      background: #48c6ef;
      color: #fff;
    }
    .upload-badge-btn {
      background: #48c6ef;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 7px 20px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 4px;
      transition: background 0.2s;
    }
    .upload-badge-btn:hover {
      background: #0097a7;
    }
    .badge-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 10px;
    }
    .badge-item {
      background: #b2ebf2;
      border: 2px solid #48c6ef;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      height: 60px;
      padding: 6px 12px;
      gap: 16px;
    }
    .badge-item img {
      max-width: 44px;
      max-height: 44px;
      border-radius: 8px;
      border: 1.5px solid #48c6ef;
      background: #fff;
    }
    .badge-filename {
      color: #0097a7;
      font-size: 0.98rem;
      word-break: break-all;
    }
    /* Modal styles */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.3); align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 24px; border-radius: 16px; text-align: center; }
    .modal-content img { width: 80px; height: 80px; border-radius: 50%; margin: 8px; cursor: pointer; border: 2px solid #48c6ef; }
    .close-modal { float: right; font-size: 1.5rem; cursor: pointer; color: #48c6ef; }
  </style>
</head>
<body>
  <div class="header">роОройрпН роЪрпБропро╡ро┐ро╡ро░роорпН</div>
  <div class="main-flex">
    <!-- Left: Profile & Posts -->
    <div class="profile-container">
      <div class="profile-pic-wrap">
        <img src="{{ profile_pic }}" alt="роЪрпБропро╡ро┐ро╡ро░ рокроЯроорпН" class="profile-pic" id="profilePic">
        <div class="edit-btn" onclick="openModal()">тЬПя╕П</div>
      </div>
      <div class="profile-info">
        <div class="profile-name">{{ name }}</div>
        <div class="profile-email">{{ email }}</div>
        <div class="stats">
          <div class="stat">
            <div class="stat-label">рокродро┐ро╡рпБроХро│рпН</div>
            <div class="stat-value">{{ post_count }}</div>
          </div>
          <div class="stat">
            <div class="stat-label">ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН</div>
            <div class="stat-value">{{ like_count }}</div>
          </div>
        </div>
        <div class="desc-section">
          <span class="desc-label">ро╡ро┐ро│роХрпНроХроорпН:</span>
          <span class="desc-text" id="descText">{{ description or "роЗройрпНройрпБроорпН ро╡ро┐ро│роХрпНроХроорпН роЗро▓рпНро▓рпИ." }}</span>
          <span class="desc-edit" onclick="editDesc()">[родро┐ро░рпБродрпНродрпБ]</span>
          <form id="descForm" method="POST" style="display:none;">
            <input type="text" name="description" id="descInput" value="{{ description }}" style="width:70%;">
            <button type="submit">роЪрпЗрооро┐роХрпНроХро╡рпБроорпН</button>
          </form>
        </div>
      </div>
      <div class="posts-section">
        <div class="posts-grid">
          {% for post in posts %}
            <img src="{{ post.image_url }}" class="post-img">
          {% endfor %}
        </div>
      </div>
    </div>
    <!-- Right: Badges -->
    <div class="badge-container">
      <div class="badge-title">ЁЯПЕ рокродро┐ро╡рпЗро▒рпНро▒рокрпНрокроЯрпНроЯ рокродроХрпНроХроЩрпНроХро│рпН</div>
      <form class="upload-badge-form" method="post" enctype="multipart/form-data" action="/upload-badge">
        <label for="badgeInput" class="custom-file-label">рокродроХрпНроХрокрпН рокроЯродрпНродрпИ родрпЗро░рпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН</label>
        <input type="file" id="badgeInput" name="badge" accept="image/png, image/jpeg" class="custom-file-input" required onchange="showFileName(this)">
        <button type="submit" class="upload-badge-btn">рокродроХрпНроХродрпНродрпИ рокродро┐ро╡рпЗро▒рпНро▒рпБ</button>
        <span id="selectedFileName" style="color:#0097a7; font-size:0.95rem; margin-top:2px;"></span>
      </form>
      <div class="badge-list">
        {% for url in badge_urls %}
          <div class="badge-item" style="justify-content:center;">
            <img src="{{ url }}" alt="рокродроХрпНроХроорпН">
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <!-- Modal for profile pic selection -->
  <div class="modal" id="picModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal()">&times;</span>
      <h3>роЪрпБропро╡ро┐ро╡ро░рокрпН рокроЯродрпНродрпИ родрпЗро░рпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН</h3>
      <img src="{{ url_for('static', filename='images/profile1.png') }}" onclick="selectPic('profile1.png')">
      <img src="{{ url_for('static', filename='images/profile2.png') }}" onclick="selectPic('profile2.png')">
      <img src="{{ url_for('static', filename='images/profile3.png') }}" onclick="selectPic('profile3.png')">
    </div>
  </div>
  <script>
    function openModal() { document.getElementById('picModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('picModal').style.display = 'none'; }
    function selectPic(pic) {
      fetch('/change-profile-pic', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({profile_pic: pic})
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Failed to change profile picture: ' + (data.error || 'Unknown error'));
        }
      });
      closeModal();
    }
    function editDesc() {
      document.getElementById('descText').style.display = 'none';
      document.getElementById('descForm').style.display = 'inline';
    }
    // Beautify file input
    document.addEventListener('DOMContentLoaded', function() {
      var badgeInput = document.getElementById('badgeInput');
      var fileLabel = document.querySelector('.custom-file-label');
      badgeInput.addEventListener('change', function() {
        var fileName = badgeInput.files[0] ? badgeInput.files[0].name : '';
        document.getElementById('selectedFileName').textContent = fileName;
      });
      fileLabel.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          badgeInput.click();
        }
      });
      fileLabel.addEventListener('click', function() {
        badgeInput.click();
      });
    });
    function showFileName(input) {
      var fileName = input.files[0] ? input.files[0].name : '';
      document.getElementById('selectedFileName').textContent = fileName;
    }
  </script>
</body>
</html>